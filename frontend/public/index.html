<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HealthQAGenAgent Frontend Demo</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f7f9fa; margin: 0; padding: 0; }
    .container { max-width: 400px; margin: 60px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 32px; }
    h1 { font-size: 1.6em; margin-bottom: 24px; color: #2a3b4c; }
    button { background: #1976d2; color: #fff; border: none; border-radius: 4px; padding: 12px 24px; font-size: 1em; cursor: pointer; margin-bottom: 16px; }
    button:hover { background: #1565c0; }
    #result { margin-top: 16px; font-size: 1.1em; color: #388e3c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>HealthQAGenAgent Demo</h1>
    <button id="generateBtn">Generate Tests</button>
    <div id="result"></div>
  </div>
  <script>
    document.getElementById('generateBtn').onclick = async function() {
      document.getElementById('result').textContent = 'Generating...';
      try {
        const res = await fetch('/api/generate-tests', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({})
        });

        // Prefer checking status first
        if (!res.ok) {
          // Try to read response text for a helpful error message
          const text = await res.text();
          document.getElementById('result').textContent = `Server error (${res.status}): ${text}`;
          return;
        }

        // Attempt to parse JSON, but handle non-JSON responses gracefully
        const contentType = res.headers.get('content-type') || '';
        let data;
        if (contentType.includes('application/json')) {
          data = await res.json();
        } else {
          const text = await res.text();
          try {
            data = JSON.parse(text);
          } catch (err) {
            // Not JSON - surface the raw text to the user instead of letting a SyntaxError bubble up
            document.getElementById('result').textContent = `Server response: ${text}`;
            return;
          }
        }

        document.getElementById('result').textContent = data.message || 'No message';
      } catch (e) {
        document.getElementById('result').textContent = 'Error: ' + e;
      }
    };
  </script>
</body>
</html>
